"use strict";(self.webpackChunkiobroker_vis_widgets_trashmaster=self.webpackChunkiobroker_vis_widgets_trashmaster||[]).push([["src_bootstrap_js-webpack_sharing_consume_default_react-dom_client_react-dom_client"],{88248:function(nt,W,n){n.r(W);var O=n(96056),j=n(4819),l=n.n(j),P=n(83413),x=n(75606),v=n(58503),L={en:n(86443),de:n(19837),ru:n(50482),pt:n(65909),nl:n(43573),fr:n(86115),it:n(79399),es:n(55117),pl:n(28130),uk:n(17138),"zh-cn":n(58246)},m=n(82490),$=n(55973),D=n(42577),R=n(71386),E=n(69073),M=n(41381),J=n(67304),I=n(88411),B=n(5542),Z=n(84543),d=n(84998),g=(c,e,t)=>new Promise((a,i)=>{var s=h=>{try{f(t.next(h))}catch(u){i(u)}},r=h=>{try{f(t.throw(h))}catch(u){i(u)}},f=h=>h.done?a(h.value):Promise.resolve(h.value).then(s,r);f((t=t.apply(c,e)).next())});const H=()=>({root:{flex:1,display:"flex",justifyContent:"center",alignItems:"center",width:"100%",overflow:"hidden"}});class C extends(window.visRxWidget||I.VisRxWidget){constructor(e){super(e),this.changeData=d.aw.bind(this),this.arr2string=d.mR.bind(this),this.getInstances=d.il.bind(this),this.refTrashIcon=l().createRef(),this.initial=!0,this.instancenameLocal=this.state.data.instancename,this.wastetypeLocal=this.state.data.wastetype,this.JsonObject={},this.oidChange=!1}static getWidgetInfo(){return{id:"tplTrashIcon",visSet:"trashmaster",visSetLabel:"vis_2_widgets_trashmaster",visSetColor:"#63C149",visName:x.i18n.t("vis_2_widgets_trashmaster_widgetname_icon"),visAttrs:[{name:"common",label:"vis_2_widgets_trashmaster_common",fields:[{name:"instancename",label:"vis_2_widgets_trashmaster_instance",type:"custom",hidden:'data.instancenamehidden === "true"',component:(e,t,a)=>d.ZP.showInstances(e,t,a)},{name:"instancenamehidden",type:"text",hidden:!0,default:"false"},{name:"selectinstances",label:"selectinstances",type:"text",hidden:!0,default:""},{name:"wastetype",label:"vis_2_widgets_trashmaster_wastetype",type:"custom",disabled:'data.wastetypedisabled === "true"',component:(e,t,a)=>this.showWasteTypes(e,t,a)},{name:"wastetypedisabled",type:"text",hidden:!0,default:"false"},{name:"selectwastetypes",label:"selectwastetypes",type:"text",hidden:!0,default:""},{name:"icon",default:"trash",label:"vis_2_widgets_trashmaster_icon",type:"select",options:[{value:"trash",label:"vis_2_widgets_trashmaster_icontrash"},{value:"yellowbag",label:"vis_2_widgets_trashmaster_iconyellowbag"},{value:"christmastree",label:"vis_2_widgets_trashmaster_iconchristmastree"},{value:"leaf",label:"vis_2_widgets_trashmaster_iconleaf"}]},{name:"trashcolor",default:"rgba(40,30,88,1)",label:"vis_2_widgets_trashmaster_trashcolor",type:"color",hidden:'data.icon !== "trash"'},{name:"trashcolorfactor",hidden:'data.icon !== "trash"',default:-.3,label:"vis_2_widgets_trashmaster_trashcolor_factor",type:"slider",min:-1,max:1,step:.1},{name:"whatsapplogo",default:!0,label:"vis_2_widgets_trashmaster_whatsapplogo",type:"custom",hidden:'data.whatsapplogohidden === "true"',component:(e,t,a)=>d.ZP.showCheckbox(e,t,a)},{name:"whatsapplogohidden",type:"text",hidden:!0,default:"false"},{name:"blink",default:!0,label:"vis_2_widgets_trashmaster_blink",type:"custom",hidden:'data.blinkhidden === "true"',component:(e,t,a)=>d.ZP.showCheckbox(e,t,a)},{name:"blinkhidden",type:"text",hidden:!0,default:"false"},{name:"blinkinterval",default:3,label:"vis_2_widgets_trashmaster_blinkinterval",type:"slider",hidden:'data.blink === false || data.blinkhidden === "true"',min:1,max:15,step:1},{name:"showdate",default:!0,label:"vis_2_widgets_trashmaster_showdate",type:"custom",component:(e,t,a)=>d.ZP.showCheckbox(e,t,a)},{name:"dateformat",default:"short",label:"vis_2_widgets_trashmaster_dateformat",type:"select",hidden:"data.showdate === false",options:[{value:"short",label:"vis_2_widgets_trashmaster_dateformat_short"},{value:"long",label:"vis_2_widgets_trashmaster_dateformat_long"}]},{name:"showdays",default:!0,label:"vis_2_widgets_trashmaster_showdays",type:"custom",component:(e,t,a)=>d.ZP.showCheckbox(e,t,a)},{name:"fontfamily",label:"vis_2_widgets_trashmaster_fontfamily",default:"Arial",type:"custom",hidden:"data.showdate === false && data.showdays === false",component:(e,t,a)=>d.ZP.showFontfamily(e,t,a,["fontsize"])},{name:"fontsize",default:20,label:"vis_2_widgets_trashmaster_fontsize",type:"slider",hidden:"data.showdate === false && data.showdays === false",min:6,max:45,step:1},{name:"oid",label:"vis_2_widgets_trashmaster_oid",type:"id",noInit:!0,hidden:!0}]}],visPrev:"widgets/trashmaster/img/trash.png"}}propertiesUpdate(){return g(this,null,function*(){if(this.initial===!0&&this.oidChange!==!0)return;const{wastetype:e,instancename:t}=this.state.data;let a=!0;typeof t!="undefined"&&this.instancenameLocal!==t&&(this.instancenameLocal=t,yield this.getWasteTypes(t),a=!1),(this.oidChange===!0||typeof e!="undefined"&&this.wastetypeLocal!==e)&&(this.wastetypeLocal=e,yield this.getJsonObject(e,this.instancenameLocal),yield this.updateWhatsappAndBlink(),a=!0,this.oidChange===!0&&(this.oidChange=!1)),a===!0&&(yield this.renderIcon())})}componentDidMount(){super.componentDidMount(),m.ZP.init(Z.Z).then(()=>{m.ZP.changeLanguage(this.props.systemConfig.common.language)}),this.getInstances().then(e=>{this.getWasteTypes(e).then(t=>{this.getJsonObject(t,e).then(()=>{this.updateWhatsappAndBlink().then(()=>{this.renderIcon().then(()=>{this.initial=!1})})})})})}getWidgetInfo(){return C.getWidgetInfo()}onRxDataChanged(){this.propertiesUpdate()}onRxStyleChanged(){}onStateUpdated(e,t){this.oidChange=!0,this.propertiesUpdate()}renderIcon(){return g(this,null,function*(){const{trashcolor:e,trashcolorfactor:t,fontfamily:a,fontsize:i,whatsapplogo:s,dateformat:r,blink:f,blinkinterval:h,showdate:u,showdays:tt}=this.state.data;if(this.refTrashIcon.current.childNodes.forEach(o=>{if(o.id==="Abfalltonne"){o.attributes.style.value=`visibility: ${this.state.data.icon==="trash"?"visible":"hidden"};`;let p="";o.childNodes.forEach(y=>{if(y.id==="tonne"&&(e===""?(this.state.data.trashcolor=y.attributes.fill.nodeValue,p=y.attributes.fill.nodeValue):(y.attributes.fill.nodeValue=this.state.data.trashcolor,p=this.state.data.trashcolor)),y.id==="tonne-innen"&&typeof p!="undefined"){const _=p.replace("rgba(","").replace(")","").split(","),S=1+t,et=Math.round(parseInt(_[0])*S),at=Math.round(parseInt(_[1])*S),st=Math.round(parseInt(_[2])*S),it=`rgba(${et},${at},${st},1)`;y.attributes.fill.nodeValue=it}})}if(o.id==="GelberSack"&&(o.attributes.style.value=`visibility: ${this.state.data.icon==="yellowbag"?"visible":"hidden"};`),o.id==="Blatt"&&(o.attributes.style.value=`visibility: ${this.state.data.icon==="leaf"?"visible":"hidden"};`),o.id==="Weihnachtsbaum"&&(o.attributes.style.value=`visibility: ${this.state.data.icon==="christmastree"?"visible":"hidden"};`),o.id==="whatsapp"&&(o.attributes.style.value=`visibility: ${s===!0?"visible":"hidden"};`),o.id.indexOf("Abfuhrdatum")!==-1){const p={year:"2-digit",month:"2-digit",day:"2-digit"};r==="long"&&(p.weekday="long"),o.innerHTML=new Date(this.JsonObject.AbfuhrtagJson).toLocaleDateString(this.props.lang,p),o.style.fontSize=`${i}px`,o.style.fontFamily=a,o.style.visibility=u===!0?"visible":"hidden"}o.id.indexOf("AnzahlTage")!==-1&&(o.innerHTML=m.ZP.t("vis_2_widgets_trashmaster_dayCollection",{count:this.JsonObject.Resttage}),o.style.fontSize=i,o.style.fontFamily=a,o.style.visibility=tt===!0?"visible":"hidden")}),f===!0&&this.JsonObject.Blinken===!0){const o=[{opacity:0},{opacity:1}],p={duration:h*1e3,iterations:1/0};this.refTrashIcon.current.animate(o,p)}else this.refTrashIcon.current.getAnimations().map(o=>o.cancel())})}getJsonObject(e,t){return g(this,null,function*(){const a=`trashmaster.${t}.WasteCalendar`;e!==""&&(yield this.props.socket.getForeignStates(a).then(i=>{if(!(a in i))return;const s=JSON.parse(i[a].val).filter(r=>r.AbfuhrartNr===e);this.JsonObject=typeof s[0]!="undefined"?s[0]:{},this.changeData({oid:a})}))})}updateWhatsappAndBlink(){return g(this,null,function*(){const e="selectwastetypes"in this.state.data&&this.state.data.selectwastetypes!==""?this.state.data.selectwastetypes.replaceAll("[","{").replaceAll("]","}").replaceAll("#",'"').split("}").slice(0,-1):[];for(let s=0;s<e.length;s++)e[s]+="}",e[s]=JSON.parse(e[s].replaceAll(/'/g,'"'));const t=e.filter(s=>s.value===this.state.data.wastetype),a=t.length>0?parseInt(t[0].whatsapp)>-1:!1;this.state.editMode===!0&&this.changeData({whatsapplogohidden:a===!0?"false":"true"}),a===!1&&this.changeData({whatsapplogo:!1});const i=t.length>0?parseInt(t[0].blink)>-1:!1;this.state.editMode===!0&&this.changeData({blinkhidden:i===!0?"false":"true"}),i===!1&&this.changeData({blink:!1})})}static showWasteTypes(e,t,a){const i="selectwastetypes"in t&&t.selectwastetypes!==""?t.selectwastetypes.replaceAll("[","{").replaceAll("]","}").replaceAll("#",'"').split("}").slice(0,-1):[];for(let s=0;s<i.length;s++)i[s]+="}",i[s]=JSON.parse(i[s].replaceAll(/'/g,'"'));return t.selectwastetypes===""?l().createElement("div",null):l().createElement(R.Z,null,l().createElement(J.Z,{value:t[e.name],onChange:s=>{a({[e.name]:s.target.value})},input:l().createElement(E.Z,{name:"wastetypes"}),label:m.ZP.t("vis_2_widgets_trashmaster_wastetype"),style:{fontSize:"12.8px"}},i.map(s=>l().createElement(M.Z,{key:s.value,value:s.value,style:{fontSize:"16px"}},s.title))))}getWasteTypes(e){return g(this,null,function*(){if(e==="")return"";const t=yield this.props.socket.getObjectViewSystem("instance","system.adapter.trashmaster.","system.adapter.trashmaster.\u9999").then(a=>{const i=[];return Object.keys(a).forEach(s=>{if(Object.keys(a).length===1||a[s]._id===`system.adapter.trashmaster.${e}`)for(let r=0;r<a[s].native.wasteTypes.length;r++)a[s].native.wasteTypes[r].used===!0&&i.push({value:a[s].native.wasteTypes[r].value,title:a[s].native.wasteTypes[r].title,whatsapp:a[s].native.wasteTypes[r].whatsapp,blink:a[s].native.wasteTypes[r].blink})}),i}).then(a=>g(this,null,function*(){return this.state.editMode&&(yield this.arr2string(a).then(i=>{this.changeData({selectwastetypes:i})}),this.changeData({wastetypedisabled:a.length<2?"true":"false"})),a})).then(a=>{if(this.initial===!0&&(!("wastetype"in this.state.data)||this.state.data.wastetype==="")){const i=a.length>0?a[0].value:"";return this.changeData({wastetype:i}),i}return a.filter(i=>i.value===this.state.data.wastetype).length>0?this.state.data.wastetype:(this.changeData({wastetype:""}),"")}).catch(a=>(console.log("ERROR !!!:"),console.log(a),""));return this.wastetypeLocal!==t&&(this.wastetypeLocal=t),t})}renderWidgetBody(e){return super.renderWidgetBody(e),l().createElement(D.Z,{class:`"card-trash${e.id}"`,style:{width:"100%",height:"100%"}},l().createElement($.Z,{style:{width:"100%",height:"100%",display:"flex",justifyContent:"center",alignItems:"center"}},l().createElement(B.r,{class:`"trashicon${e.id}"`,ref:this.refTrashIcon})))}}var F=(0,v.withStyles)(H)((0,v.withTheme)(C)),z=n(10722),N=n(96875),b=n(59357),U=n(42959),A=n(44583),w=(c,e,t)=>new Promise((a,i)=>{var s=h=>{try{f(t.next(h))}catch(u){i(u)}},r=h=>{try{f(t.throw(h))}catch(u){i(u)}},f=h=>h.done?a(h.value):Promise.resolve(h.value).then(s,r);f((t=t.apply(c,e)).next())});const V=()=>({root:{flex:1,display:"flex",justifyContent:"center",alignItems:"center",width:"100%",overflow:"hidden"}});class T extends(window.visRxWidget||I.VisRxWidget){constructor(e){super(e),this.arr2string=d.mR.bind(this),this.changeData=d.aw.bind(this),this.getInstances=d.il.bind(this),this.initial=!0,this.instancenameLocal=this.state.data.instancename,this.dayformatLocal=this.state.data.dayformat,this.oidChange=!1,this.wasteCalendar=[],this.refTable=l().createRef(),this.refTableBody=l().createRef(),this.refTableHeader=l().createRef()}static getWidgetInfo(){return{id:"tplTrashTable",visSet:"trashmaster",visName:x.i18n.t("vis_2_widgets_trashmaster_widgetname_table"),visAttrs:[{name:"common",label:"vis_2_widgets_trashmaster_common",fields:[{name:"instancename",label:"vis_2_widgets_trashmaster_instance",type:"custom",hidden:'data.instancenamehidden === "true"',component:(e,t,a)=>d.ZP.showInstances(e,t,a)},{name:"instancenamehidden",type:"text",hidden:!0,default:"false"},{name:"selectinstances",label:"selectinstances",type:"text",hidden:!0,default:""},{name:"dayformat",default:"short",label:"vis_2_widgets_trashmaster_dayformat",type:"select",options:[{value:"short",label:"vis_2_widgets_trashmaster_dateformat_short"},{value:"long",label:"vis_2_widgets_trashmaster_dateformat_long"}]},{name:"fontfamily",label:"vis_2_widgets_trashmaster_fontfamily",default:"Arial",type:"custom",hidden:"data.showdate === false && data.showdays === false",component:(e,t,a)=>d.ZP.showFontfamily(e,t,a,["fontsizeheader","fontsizebody","fontsizemonth"])},{name:"showheader",default:!0,label:"vis_2_widgets_trashmaster_showheader",type:"custom",component:(e,t,a)=>d.ZP.showCheckbox(e,t,a)},{name:"fontsizeheader",default:12,label:"vis_2_widgets_trashmaster_fontsize_header",type:"slider",hidden:"data.showheader === false",min:6,max:24,step:1},{name:"fontsizemonth",default:10,label:"vis_2_widgets_trashmaster_fontsize_month",type:"slider",min:6,max:24,step:1},{name:"fontsizebody",default:10,label:"vis_2_widgets_trashmaster_fontsize_body",type:"slider",min:6,max:24,step:1},{name:"oid",label:"vis_2_widgets_trashmaster_oid",type:"id",noInit:!0,hidden:!0}]}],visPrev:"widgets/trashmaster/img/table.png"}}propertiesUpdate(){return w(this,null,function*(){if(this.initial===!0&&this.oidChange!==!0)return;const{dayformat:e,instancename:t}=this.state.data;(typeof t!="undefined"&&this.instancenameLocal!==t||this.oidChange===!0||this.dayformatLocal!==e)&&(this.instancenameLocal=t,this.dayformatLocal=e,yield this.getWasteCalendar(t),this.oidChange===!0&&(this.oidChange=!1))})}componentDidMount(){super.componentDidMount(),m.ZP.init(Z.Z).then(()=>{m.ZP.changeLanguage(this.props.systemConfig.common.language)}),this.getInstances().then(e=>{this.getWasteCalendar(e).then(()=>{this.changeTableSize().then(()=>{this.initial=!1})})})}getWidgetInfo(){return T.getWidgetInfo()}onRxDataChanged(){this.propertiesUpdate()}onRxStyleChanged(){this.changeTableSize()}changeTableSize(){return w(this,null,function*(){const e=this.refService.current.clientHeight;if(e!==0){const a=this.state.data.showheader===!1?0:parseInt(this.refTableHeader.current.offsetHeight),i=`${(e-2).toString()}px`,s=`${(e-a-10).toString()}px`;this.refTable.current.style.height=i,this.refTableBody.current.style.height=s}const t=this.refService.current.clientWidth;if(t!==0){const a=`${(t-2).toString()}px`;this.refTable.current.style.width=a,this.refTableBody.current.style.width=a,this.refTableHeader.current.style.width=a}})}onStateUpdated(e,t){this.oidChange=!0,this.propertiesUpdate()}getCalendarObject(e){return w(this,null,function*(){const t=`trashmaster.${e}.WasteCalendar`;return yield this.props.socket.getForeignStates(t).then(i=>!(t in i)||typeof i[t].val=="undefined"?{}:(this.changeData({oid:t}),JSON.parse(i[t].val)))})}getWasteCalendar(e){return w(this,null,function*(){let t="",a="";this.wasteCalendar=[];const i=[],s=yield this.getCalendarObject(e);typeof s=="undefined"||Object.entries(s).length===0||(Object.entries(s).map(r=>{t!==r[1].Monatsname&&(i.push({col1span:3,col2span:0,col3span:0,col1:`${r[1].Monatsname} ${r[1].Jahr}`,col2:"",col3:""}),t=r[1].Monatsname),a!==r[1].Abfuhrdatum?(i.push({col1span:1,col2span:1,col3span:1,col1:`${this.state.data.dayformat==="short"?`${r[1].AbfuhrTagKurz}.`:r[1].AbfuhrTagLang}`,col2:`${r[1].Tag}.`,col3:r[1].Abfuhrart}),a=r[1].Abfuhrdatum):i.push({col1span:2,col2span:0,col3span:1,col1:"",col2:"",col3:r[1].Abfuhrart})}),this.wasteCalendar=[...i])})}renderWidgetBody(e){return super.renderWidgetBody(e),l().createElement("div",{ref:this.refTable,style:{overflow:"auto"}},this.state.data.showheader===!0&&l().createElement(z.Z,null,l().createElement(U.Z,{ref:this.refTableHeader},l().createElement(A.Z,null,l().createElement(b.Z,{sx:{fontSize:this.state.data.fontsizeheader,fontFamily:this.state.data.fontfamily},colSpan:3,align:"left"},l().createElement("b",null,m.ZP.t("vis_2_widgets_trashmaster_widgetname_table")))))),l().createElement("div",{ref:this.refTableBody,style:{overflow:"auto",height:"200px",width:"100%"}},l().createElement(z.Z,{size:"small"},l().createElement(N.Z,null,this.wasteCalendar.map((t,a)=>l().createElement(A.Z,{key:a},t.col1span>0&&l().createElement(b.Z,{sx:{fontSize:t.col1span===3?this.state.data.fontsizemonth:this.state.data.fontsizebody,fontFamily:this.state.data.fontfamily},colSpan:t.col1span,align:"left"},t.col1),t.col2span>0&&l().createElement(b.Z,{sx:{fontSize:this.state.data.fontsizebody,fontFamily:this.state.data.fontfamily},colSpan:t.col2span,align:"left"},t.col2),t.col3span>0&&l().createElement(b.Z,{sx:{fontSize:this.state.data.fontsizebody,fontFamily:this.state.data.fontfamily},colSpan:t.col3span,align:"left"},t.col3)))))))}}var k=(0,v.withStyles)(V)((0,v.withTheme)(T)),G=Object.defineProperty,K=(c,e,t)=>e in c?G(c,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):c[e]=t,Q=(c,e,t)=>(K(c,typeof e!="symbol"?e+"":e,t),t);const X=c=>{var e,t;return{app:{backgroundColor:(e=c==null?void 0:c.palette)==null?void 0:e.background.default,color:(t=c==null?void 0:c.palette)==null?void 0:t.text.primary,height:"100%",width:"100%",overflow:"auto",display:"flex"}}};class Y extends P.Z{constructor(e){super(e),Q(this,"onConnectionChanged",t=>{t&&this.socket.getSystemConfig().then(a=>this.setState({systemConfig:a}))}),x.i18n.extendTranslations(L),this.socket.registerConnectionHandler(this.onConnectionChanged)}renderWidget(){return l().createElement("div",{className:this.props.classes.app},l().createElement(F,{style:{width:560,height:530}}),l().createElement(k,null))}}var q=(0,v.withStyles)(X)(Y);(0,O.Z)(q)}}]);

//# sourceMappingURL=src_bootstrap_js-webpack_sharing_consume_default_react-dom_client_react-dom_client.0d0bca23.chunk.js.map