"use strict";(self.webpackChunkiobroker_vis_widgets_trashmaster=self.webpackChunkiobroker_vis_widgets_trashmaster||[]).push([["src_TrashTable_jsx"],{25173:function(M,p,s){s.r(p);var T=s(4819),n=s.n(T),f=s(82490),v=s(75606),W=s.n(v),y=s(10722),C=s(96875),d=s(59357),P=s(42959),b=s(44583),c=s(58503),I=s.n(c),E=s(88411),R=s.n(E),w=s(84543),h=s(84998),_=(D,e,t)=>new Promise((a,i)=>{var o=r=>{try{u(t.next(r))}catch(g){i(g)}},l=r=>{try{u(t.throw(r))}catch(g){i(g)}},u=r=>r.done?a(r.value):Promise.resolve(r.value).then(o,l);u((t=t.apply(D,e)).next())});const O=()=>({root:{flex:1,display:"flex",justifyContent:"center",alignItems:"center",width:"100%",overflow:"hidden"}});class m extends(window.visRxWidget||E.VisRxWidget){constructor(e){super(e),this.arr2string=h.mR.bind(this),this.changeData=h.aw.bind(this),this.getInstances=h.il.bind(this),this.initial=!0,this.instancenameLocal=this.state.data.instancename,this.dayformatLocal=this.state.data.dayformat,this.oidChange=!1,this.wasteCalendar=[],this.refTable=n().createRef(),this.refTableBody=n().createRef(),this.refTableHeader=n().createRef()}static getWidgetInfo(){return{id:"tplTrashTable",visSet:"trashmaster",visName:v.i18n.t("vis_2_widgets_trashmaster_widgetname_table"),visAttrs:[{name:"common",label:"vis_2_widgets_trashmaster_common",fields:[{name:"instancename",label:"vis_2_widgets_trashmaster_instance",type:"custom",hidden:'data.instancenamehidden === "true"',component:(e,t,a)=>h.ZP.showInstances(e,t,a)},{name:"instancenamehidden",type:"text",hidden:!0,default:"false"},{name:"selectinstances",label:"selectinstances",type:"text",hidden:!0,default:""},{name:"dayformat",default:"short",label:"vis_2_widgets_trashmaster_dayformat",type:"select",options:[{value:"short",label:"vis_2_widgets_trashmaster_dateformat_short"},{value:"long",label:"vis_2_widgets_trashmaster_dateformat_long"}]},{name:"fontfamily",label:"vis_2_widgets_trashmaster_fontfamily",default:"Arial",type:"custom",hidden:"data.showdate === false && data.showdays === false",component:(e,t,a)=>h.ZP.showFontfamily(e,t,a,["fontsizeheader","fontsizebody","fontsizemonth"])},{name:"showheader",default:!0,label:"vis_2_widgets_trashmaster_showheader",type:"custom",component:(e,t,a)=>h.ZP.showCheckbox(e,t,a)},{name:"fontsizeheader",default:12,label:"vis_2_widgets_trashmaster_fontsize_header",type:"slider",hidden:"data.showheader === false",min:6,max:24,step:1},{name:"fontsizemonth",default:10,label:"vis_2_widgets_trashmaster_fontsize_month",type:"slider",min:6,max:24,step:1},{name:"fontsizebody",default:10,label:"vis_2_widgets_trashmaster_fontsize_body",type:"slider",min:6,max:24,step:1},{name:"oid",label:"vis_2_widgets_trashmaster_oid",type:"id",noInit:!0,hidden:!0}]}],visPrev:"widgets/trashmaster/img/table.png"}}propertiesUpdate(){return _(this,null,function*(){if(this.initial===!0&&this.oidChange!==!0)return;const{dayformat:e,instancename:t}=this.state.data;(typeof t!="undefined"&&this.instancenameLocal!==t||this.oidChange===!0||this.dayformatLocal!==e)&&(this.instancenameLocal=t,this.dayformatLocal=e,yield this.getWasteCalendar(t),this.oidChange===!0&&(this.oidChange=!1))})}componentDidMount(){super.componentDidMount(),f.ZP.init(w.Z).then(()=>{f.ZP.changeLanguage(this.props.systemConfig.common.language)}),this.getInstances().then(e=>{this.getWasteCalendar(e).then(()=>{this.changeTableSize().then(()=>{this.initial=!1})})})}getWidgetInfo(){return m.getWidgetInfo()}onRxDataChanged(){this.propertiesUpdate()}onRxStyleChanged(){this.changeTableSize()}changeTableSize(){return _(this,null,function*(){const e=this.refService.current.clientHeight;if(e!==0){const a=this.state.data.showheader===!1?0:parseInt(this.refTableHeader.current.offsetHeight),i=`${(e-2).toString()}px`,o=`${(e-a-10).toString()}px`;this.refTable.current.style.height=i,this.refTableBody.current.style.height=o}const t=this.refService.current.clientWidth;if(t!==0){const a=`${(t-2).toString()}px`;this.refTable.current.style.width=a,this.refTableBody.current.style.width=a,this.refTableHeader.current.style.width=a}})}onStateUpdated(e,t){this.oidChange=!0,this.propertiesUpdate()}getCalendarObject(e){return _(this,null,function*(){const t=`trashmaster.${e}.WasteCalendar`;return yield this.props.socket.getForeignStates(t).then(i=>!(t in i)||typeof i[t].val=="undefined"?{}:(this.changeData({oid:t}),JSON.parse(i[t].val)))})}getWasteCalendar(e){return _(this,null,function*(){let t="",a="";this.wasteCalendar=[];const i=[],o=yield this.getCalendarObject(e);typeof o=="undefined"||Object.entries(o).length===0||(Object.entries(o).map(l=>{t!==l[1].Monatsname&&(i.push({col1span:3,col2span:0,col3span:0,col1:`${l[1].Monatsname} ${l[1].Jahr}`,col2:"",col3:""}),t=l[1].Monatsname),a!==l[1].Abfuhrdatum?(i.push({col1span:1,col2span:1,col3span:1,col1:`${this.state.data.dayformat==="short"?`${l[1].AbfuhrTagKurz}.`:l[1].AbfuhrTagLang}`,col2:`${l[1].Tag}.`,col3:l[1].Abfuhrart}),a=l[1].Abfuhrdatum):i.push({col1span:2,col2span:0,col3span:1,col1:"",col2:"",col3:l[1].Abfuhrart})}),this.wasteCalendar=[...i])})}renderWidgetBody(e){return super.renderWidgetBody(e),n().createElement("div",{ref:this.refTable,style:{overflow:"auto"}},this.state.data.showheader===!0&&n().createElement(y.Z,null,n().createElement(P.Z,{ref:this.refTableHeader},n().createElement(b.Z,null,n().createElement(d.Z,{sx:{fontSize:this.state.data.fontsizeheader,fontFamily:this.state.data.fontfamily},colSpan:3,align:"left"},n().createElement("b",null,f.ZP.t("vis_2_widgets_trashmaster_widgetname_table")))))),n().createElement("div",{ref:this.refTableBody,style:{overflow:"auto",height:"200px",width:"100%"}},n().createElement(y.Z,{size:"small"},n().createElement(C.Z,null,this.wasteCalendar.map((t,a)=>n().createElement(b.Z,{key:a},t.col1span>0&&n().createElement(d.Z,{sx:{fontSize:t.col1span===3?this.state.data.fontsizemonth:this.state.data.fontsizebody,fontFamily:this.state.data.fontfamily},colSpan:t.col1span,align:"left"},t.col1),t.col2span>0&&n().createElement(d.Z,{sx:{fontSize:this.state.data.fontsizebody,fontFamily:this.state.data.fontfamily},colSpan:t.col2span,align:"left"},t.col2),t.col3span>0&&n().createElement(d.Z,{sx:{fontSize:this.state.data.fontsizebody,fontFamily:this.state.data.fontfamily},colSpan:t.col3span,align:"left"},t.col3)))))))}}p.default=(0,c.withStyles)(O)((0,c.withTheme)(m))}}]);

//# sourceMappingURL=src_TrashTable_jsx.87c3abac.chunk.js.map