"use strict";(self.webpackChunkiobroker_vis_widgets_trashmaster=self.webpackChunkiobroker_vis_widgets_trashmaster||[]).push([["src_TrashIcon_jsx"],{13164:function(W,c,e){e.r(c);var u=e(4819),r=e.n(u),_=e(82490),v=e(75606),y=e.n(v),K=e(55973),C=e(42577),D=e(71386),I=e(69073),b=e(41381),w=e(67304),g=e(58503),U=e.n(g),M=e(88411),B=e.n(M),T=e(5542),A=e(84543),d=e(84998),o=(P,s,a)=>new Promise((t,n)=>{var i=p=>{try{R(a.next(p))}catch(L){n(L)}},h=p=>{try{R(a.throw(p))}catch(L){n(L)}},R=p=>p.done?t(p.value):Promise.resolve(p.value).then(i,h);R((a=a.apply(P,s)).next())});const f=()=>({root:{flex:1,display:"flex",justifyContent:"center",alignItems:"center",width:"100%",overflow:"hidden"}});class m extends(window.visRxWidget||M.VisRxWidget){constructor(s){super(s),this.changeData=d.aw.bind(this),this.arr2string=d.mR.bind(this),this.getInstances=d.il.bind(this),this.refTrashIcon=r().createRef(),this.initial=!0,this.instancenameLocal=this.state.data.instancename,this.wastetypeLocal=this.state.data.wastetype,this.JsonObject={},this.oidChange=!1}static getWidgetInfo(){return{id:"tplTrashIcon",visSet:"trashmaster",visSetLabel:"vis_2_widgets_trashmaster",visSetColor:"#63C149",visName:v.i18n.t("vis_2_widgets_trashmaster_widgetname_icon"),visAttrs:[{name:"common",label:"vis_2_widgets_trashmaster_common",fields:[{name:"instancename",label:"vis_2_widgets_trashmaster_instance",type:"custom",hidden:'data.instancenamehidden === "true"',component:(s,a,t)=>d.ZP.showInstances(s,a,t)},{name:"instancenamehidden",type:"text",hidden:!0,default:"false"},{name:"selectinstances",label:"selectinstances",type:"text",hidden:!0,default:""},{name:"wastetype",label:"vis_2_widgets_trashmaster_wastetype",type:"custom",disabled:'data.wastetypedisabled === "true"',component:(s,a,t)=>this.showWasteTypes(s,a,t)},{name:"wastetypedisabled",type:"text",hidden:!0,default:"false"},{name:"selectwastetypes",label:"selectwastetypes",type:"text",hidden:!0,default:""},{name:"icon",default:"trash",label:"vis_2_widgets_trashmaster_icon",type:"select",options:[{value:"trash",label:"vis_2_widgets_trashmaster_icontrash"},{value:"yellowbag",label:"vis_2_widgets_trashmaster_iconyellowbag"},{value:"christmastree",label:"vis_2_widgets_trashmaster_iconchristmastree"},{value:"leaf",label:"vis_2_widgets_trashmaster_iconleaf"}]},{name:"trashcolor",default:"rgba(40,30,88,1)",label:"vis_2_widgets_trashmaster_trashcolor",type:"color",hidden:'data.icon !== "trash"'},{name:"trashcolorfactor",hidden:'data.icon !== "trash"',default:-.3,label:"vis_2_widgets_trashmaster_trashcolor_factor",type:"slider",min:-1,max:1,step:.1},{name:"whatsapplogo",default:!0,label:"vis_2_widgets_trashmaster_whatsapplogo",type:"custom",hidden:'data.whatsapplogohidden === "true"',component:(s,a,t)=>d.ZP.showCheckbox(s,a,t)},{name:"whatsapplogohidden",type:"text",hidden:!0,default:"false"},{name:"blink",default:!0,label:"vis_2_widgets_trashmaster_blink",type:"custom",hidden:'data.blinkhidden === "true"',component:(s,a,t)=>d.ZP.showCheckbox(s,a,t)},{name:"blinkhidden",type:"text",hidden:!0,default:"false"},{name:"blinkinterval",default:3,label:"vis_2_widgets_trashmaster_blinkinterval",type:"slider",hidden:'data.blink === false || data.blinkhidden === "true"',min:1,max:15,step:1},{name:"showdate",default:!0,label:"vis_2_widgets_trashmaster_showdate",type:"custom",component:(s,a,t)=>d.ZP.showCheckbox(s,a,t)},{name:"dateformat",default:"short",label:"vis_2_widgets_trashmaster_dateformat",type:"select",hidden:"data.showdate === false",options:[{value:"short",label:"vis_2_widgets_trashmaster_dateformat_short"},{value:"long",label:"vis_2_widgets_trashmaster_dateformat_long"}]},{name:"showdays",default:!0,label:"vis_2_widgets_trashmaster_showdays",type:"custom",component:(s,a,t)=>d.ZP.showCheckbox(s,a,t)},{name:"fontfamily",label:"vis_2_widgets_trashmaster_fontfamily",default:"Arial",type:"custom",hidden:"data.showdate === false && data.showdays === false",component:(s,a,t)=>d.ZP.showFontfamily(s,a,t,["fontsize"])},{name:"fontsize",default:20,label:"vis_2_widgets_trashmaster_fontsize",type:"slider",hidden:"data.showdate === false && data.showdays === false",min:6,max:45,step:1},{name:"oid",label:"vis_2_widgets_trashmaster_oid",type:"id",noInit:!0,hidden:!0}]}],visPrev:"widgets/trashmaster/img/trash.png"}}propertiesUpdate(){return o(this,null,function*(){if(this.initial===!0&&this.oidChange!==!0)return;const{wastetype:s,instancename:a}=this.state.data;let t=!0;typeof a!="undefined"&&this.instancenameLocal!==a&&(this.instancenameLocal=a,yield this.getWasteTypes(a),t=!1),(this.oidChange===!0||typeof s!="undefined"&&this.wastetypeLocal!==s)&&(this.wastetypeLocal=s,yield this.getJsonObject(s,this.instancenameLocal),yield this.updateWhatsappAndBlink(),t=!0,this.oidChange===!0&&(this.oidChange=!1)),t===!0&&(yield this.renderIcon())})}componentDidMount(){super.componentDidMount(),_.ZP.init(A.Z).then(()=>{_.ZP.changeLanguage(this.props.systemConfig.common.language)}),this.getInstances().then(s=>{this.getWasteTypes(s).then(a=>{this.getJsonObject(a,s).then(()=>{this.updateWhatsappAndBlink().then(()=>{this.renderIcon().then(()=>{this.initial=!1})})})})})}getWidgetInfo(){return m.getWidgetInfo()}onRxDataChanged(){this.propertiesUpdate()}onRxStyleChanged(){}onStateUpdated(s,a){this.oidChange=!0,this.propertiesUpdate()}renderIcon(){return o(this,null,function*(){const{trashcolor:s,trashcolorfactor:a,fontfamily:t,fontsize:n,whatsapplogo:i,dateformat:h,blink:R,blinkinterval:p,showdate:L,showdays:S}=this.state.data;if(this.refTrashIcon.current.childNodes.forEach(l=>{if(l.id==="Abfalltonne"){l.attributes.style.value=`visibility: ${this.state.data.icon==="trash"?"visible":"hidden"};`;let E="";l.childNodes.forEach(O=>{if(O.id==="tonne"&&(s===""?(this.state.data.trashcolor=O.attributes.fill.nodeValue,E=O.attributes.fill.nodeValue):(O.attributes.fill.nodeValue=this.state.data.trashcolor,E=this.state.data.trashcolor)),O.id==="tonne-innen"&&typeof E!="undefined"){const x=E.replace("rgba(","").replace(")","").split(","),Z=1+a,j=Math.round(parseInt(x[0])*Z),N=Math.round(parseInt(x[1])*Z),J=Math.round(parseInt(x[2])*Z),$=`rgba(${j},${N},${J},1)`;O.attributes.fill.nodeValue=$}})}if(l.id==="GelberSack"&&(l.attributes.style.value=`visibility: ${this.state.data.icon==="yellowbag"?"visible":"hidden"};`),l.id==="Blatt"&&(l.attributes.style.value=`visibility: ${this.state.data.icon==="leaf"?"visible":"hidden"};`),l.id==="Weihnachtsbaum"&&(l.attributes.style.value=`visibility: ${this.state.data.icon==="christmastree"?"visible":"hidden"};`),l.id==="whatsapp"&&(l.attributes.style.value=`visibility: ${i===!0?"visible":"hidden"};`),l.id.indexOf("Abfuhrdatum")!==-1){const E={year:"2-digit",month:"2-digit",day:"2-digit"};h==="long"&&(E.weekday="long"),l.innerHTML=new Date(this.JsonObject.AbfuhrtagJson).toLocaleDateString(this.props.lang,E),l.style.fontSize=`${n}px`,l.style.fontFamily=t,l.style.visibility=L===!0?"visible":"hidden"}l.id.indexOf("AnzahlTage")!==-1&&(l.innerHTML=_.ZP.t("vis_2_widgets_trashmaster_dayCollection",{count:this.JsonObject.Resttage}),l.style.fontSize=n,l.style.fontFamily=t,l.style.visibility=S===!0?"visible":"hidden")}),R===!0&&this.JsonObject.Blinken===!0){const l=[{opacity:0},{opacity:1}],E={duration:p*1e3,iterations:1/0};this.refTrashIcon.current.animate(l,E)}else this.refTrashIcon.current.getAnimations().map(l=>l.cancel())})}getJsonObject(s,a){return o(this,null,function*(){const t=`trashmaster.${a}.WasteCalendar`;s!==""&&(yield this.props.socket.getForeignStates(t).then(n=>{if(!(t in n))return;const i=JSON.parse(n[t].val).filter(h=>h.AbfuhrartNr===s);this.JsonObject=typeof i[0]!="undefined"?i[0]:{},this.changeData({oid:t})}))})}updateWhatsappAndBlink(){return o(this,null,function*(){const s="selectwastetypes"in this.state.data&&this.state.data.selectwastetypes!==""?this.state.data.selectwastetypes.replaceAll("[","{").replaceAll("]","}").replaceAll("#",'"').split("}").slice(0,-1):[];for(let i=0;i<s.length;i++)s[i]+="}",s[i]=JSON.parse(s[i].replaceAll(/'/g,'"'));const a=s.filter(i=>i.value===this.state.data.wastetype),t=a.length>0?parseInt(a[0].whatsapp)>-1:!1;this.state.editMode===!0&&this.changeData({whatsapplogohidden:t===!0?"false":"true"}),t===!1&&this.changeData({whatsapplogo:!1});const n=a.length>0?parseInt(a[0].blink)>-1:!1;this.state.editMode===!0&&this.changeData({blinkhidden:n===!0?"false":"true"}),n===!1&&this.changeData({blink:!1})})}static showWasteTypes(s,a,t){const n="selectwastetypes"in a&&a.selectwastetypes!==""?a.selectwastetypes.replaceAll("[","{").replaceAll("]","}").replaceAll("#",'"').split("}").slice(0,-1):[];for(let i=0;i<n.length;i++)n[i]+="}",n[i]=JSON.parse(n[i].replaceAll(/'/g,'"'));return a.selectwastetypes===""?r().createElement("div",null):r().createElement(D.Z,null,r().createElement(w.Z,{value:a[s.name],onChange:i=>{t({[s.name]:i.target.value})},input:r().createElement(I.Z,{name:"wastetypes"}),label:_.ZP.t("vis_2_widgets_trashmaster_wastetype"),style:{fontSize:"12.8px"}},n.map(i=>r().createElement(b.Z,{key:i.value,value:i.value,style:{fontSize:"16px"}},i.title))))}getWasteTypes(s){return o(this,null,function*(){if(s==="")return"";const a=yield this.props.socket.getObjectViewSystem("instance","system.adapter.trashmaster.","system.adapter.trashmaster.\u9999").then(t=>{const n=[];return Object.keys(t).forEach(i=>{if(Object.keys(t).length===1||t[i]._id===`system.adapter.trashmaster.${s}`)for(let h=0;h<t[i].native.wasteTypes.length;h++)t[i].native.wasteTypes[h].used===!0&&n.push({value:t[i].native.wasteTypes[h].value,title:t[i].native.wasteTypes[h].title,whatsapp:t[i].native.wasteTypes[h].whatsapp,blink:t[i].native.wasteTypes[h].blink})}),n}).then(t=>o(this,null,function*(){return this.state.editMode&&(yield this.arr2string(t).then(n=>{this.changeData({selectwastetypes:n})}),this.changeData({wastetypedisabled:t.length<2?"true":"false"})),t})).then(t=>{if(this.initial===!0&&(!("wastetype"in this.state.data)||this.state.data.wastetype==="")){const n=t.length>0?t[0].value:"";return this.changeData({wastetype:n}),n}return t.filter(n=>n.value===this.state.data.wastetype).length>0?this.state.data.wastetype:(this.changeData({wastetype:""}),"")}).catch(t=>(console.log("ERROR !!!:"),console.log(t),""));return this.wastetypeLocal!==a&&(this.wastetypeLocal=a),a})}renderWidgetBody(s){return super.renderWidgetBody(s),r().createElement(C.Z,{class:`"card-trash${s.id}"`,style:{width:"100%",height:"100%"}},r().createElement(K.Z,{style:{width:"100%",height:"100%",display:"flex",justifyContent:"center",alignItems:"center"}},r().createElement(T.r,{class:`"trashicon${s.id}"`,ref:this.refTrashIcon})))}}c.default=(0,g.withStyles)(f)((0,g.withTheme)(m))},55973:function(W,c,e){var u=e(87462),r=e(63366),_=e(4819),v=e.n(_),y=e(15854),K=e.n(y),C=e(64983),D=e.n(C),I=e(13957),b=e(82500),w=e(89857),g=e(4502),U=e(67557);const M=["className","component"],B=d=>{const{classes:o}=d,f={root:["root"]};return(0,I.Z)(f,g.N,o)},T=(0,b.ZP)("div",{name:"MuiCardContent",slot:"Root",overridesResolver:(d,o)=>o.root})(()=>({padding:16,"&:last-child":{paddingBottom:24}})),A=_.forwardRef(function(o,f){const m=(0,w.Z)({props:o,name:"MuiCardContent"}),{className:P,component:s="div"}=m,a=(0,r.Z)(m,M),t=(0,u.Z)({},m,{component:s}),n=B(t);return(0,U.jsx)(T,(0,u.Z)({as:s,className:D()(n.root,P),ownerState:t,ref:f},a))});c.Z=A},4502:function(W,c,e){e.d(c,{N:function(){return _}});var u=e(67402),r=e(85111);function _(y){return(0,r.Z)("MuiCardContent",y)}const v=(0,u.Z)("MuiCardContent",["root"]);c.Z=v},42577:function(W,c,e){var u=e(87462),r=e(63366),_=e(4819),v=e.n(_),y=e(15854),K=e.n(y),C=e(64983),D=e.n(C),I=e(13957),b=e(82500),w=e(89857),g=e(30464),U=e(53478),M=e(67557);const B=["className","raised"],T=o=>{const{classes:f}=o,m={root:["root"]};return(0,I.Z)(m,U.y,f)},A=(0,b.ZP)(g.Z,{name:"MuiCard",slot:"Root",overridesResolver:(o,f)=>f.root})(()=>({overflow:"hidden"})),d=_.forwardRef(function(f,m){const P=(0,w.Z)({props:f,name:"MuiCard"}),{className:s,raised:a=!1}=P,t=(0,r.Z)(P,B),n=(0,u.Z)({},P,{raised:a}),i=T(n);return(0,M.jsx)(A,(0,u.Z)({className:D()(i.root,s),elevation:a?8:void 0,ref:m,ownerState:n},t))});c.Z=d},53478:function(W,c,e){e.d(c,{y:function(){return _}});var u=e(67402),r=e(85111);function _(y){return(0,r.Z)("MuiCard",y)}const v=(0,u.Z)("MuiCard",["root"]);c.Z=v}}]);

//# sourceMappingURL=src_TrashIcon_jsx.3ee0e79f.chunk.js.map